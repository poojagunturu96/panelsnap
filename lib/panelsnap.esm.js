/**
 * PanelSnap.js v0.0.0-development
 * Copyright (c) 2013-present, Guido Bouman
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
import t from"tweezer.js";function n(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function e(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(n){o(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))}))}return t}function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function r(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return s(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return s(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function a(t){return t!==document.body?t:"scrollingElement"in document?document.scrollingElement:navigator.userAgent.indexOf("WebKit")>-1?document.body:document.documentElement}function l(t){if(t===document.body){var n=document.documentElement;return{top:0,left:0,bottom:n.clientHeight,right:n.clientWidth,height:n.clientHeight,width:n.clientWidth}}return t.getBoundingClientRect()}function c(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=l(t),r=n.getBoundingClientRect(),s=r.top-o.top,c=r.left-o.left,h=e?r.height-o.height:0,u=i?r.width-o.width:0,f=a(t);return{top:s+h+f.scrollTop,left:c+u+f.scrollLeft}}var h=function(){var t=!1;try{var n=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,n),window.removeEventListener("test",null,n)}catch(t){}return t}(),u=0,f={container:document.body,panelSelector:"> section",directionThreshold:50,delay:0,duration:300,easing:function(t){return t}},p=function(){function n(t){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.options=e(e({},f),t),this.options.container.dataset.panelsnapId)throw new Error("PanelSnap is already initialised on this container, aborting.");var i;this.container=this.options.container,this.scrollContainer=a(this.container),this.scrollEventContainer=(i=this.container)===document.body?window:a(i),u+=1,this.instanceIndex=u,this.container.dataset.panelsnapId=this.instanceIndex;var o='[data-panelsnap-id="'.concat(this.instanceIndex,'"] ').concat(this.options.panelSelector);this.panelList=Array.from(document.querySelectorAll(o)),this.events=[],this.isEnabled=!0,this.isInteracting=!1,this.scrollTimeout=null,this.resetAnimation(),this.onInteractStart=this.onInteractStart.bind(this),this.onInteractStop=this.onInteractStop.bind(this),this.onInteractStart=this.onInteractStart.bind(this),this.onInteractStop=this.onInteractStop.bind(this),this.onInteractStart=this.onInteractStart.bind(this),this.onInteractStop=this.onInteractStop.bind(this),this.onScroll=this.onScroll.bind(this),this.onInteract=this.onInteract.bind(this),this.scrollEventContainer.addEventListener("keydown",this.onInteractStart,h&&{passive:!0}),this.scrollEventContainer.addEventListener("keyup",this.onInteractStop,h&&{passive:!0}),this.scrollEventContainer.addEventListener("mousedown",this.onInteractStart,h&&{passive:!0}),this.scrollEventContainer.addEventListener("mouseup",this.onInteractStop,h&&{passive:!0}),this.scrollEventContainer.addEventListener("touchstart",this.onInteractStart,h&&{passive:!0}),this.scrollEventContainer.addEventListener("touchend",this.onInteractStop,h&&{passive:!0}),this.scrollEventContainer.addEventListener("scroll",this.onScroll,h&&{passive:!0}),this.scrollEventContainer.addEventListener("wheel",this.onInteract,h&&{passive:!0}),this.findSnapTarget()}var o,s,p;return o=n,s=[{key:"destroy",value:function(){this.stopAnimation(),this.disable(),this.scrollEventContainer.removeEventListener("keydown",this.onInteractStart,h&&{passive:!0}),this.scrollEventContainer.removeEventListener("keyup",this.onInteractStop,h&&{passive:!0}),this.scrollEventContainer.removeEventListener("mousedown",this.onInteractStart,h&&{passive:!0}),this.scrollEventContainer.removeEventListener("mouseup",this.onInteractStop,h&&{passive:!0}),this.scrollEventContainer.removeEventListener("touchstart",this.onInteractStart,h&&{passive:!0}),this.scrollEventContainer.removeEventListener("touchend",this.onInteractStop,h&&{passive:!0}),this.scrollEventContainer.removeEventListener("scroll",this.onScroll,h&&{passive:!0}),this.scrollEventContainer.removeEventListener("wheel",this.onInteract,h&&{passive:!0}),delete this.options.container.dataset.panelsnapId}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1}},{key:"on",value:function(t,n){var e=this.events[t]||[];this.events[t]=[].concat(r(e),[n]),"activatePanel"===t&&n.call(this,this.activePanel)}},{key:"off",value:function(t,n){var e=this.events[t]||[];this.events[t]=e.filter((function(t){return t!==n}))}},{key:"emit",value:function(t,n){var e=this;(this.events[t]||[]).forEach((function(t){return t.call(e,n)}))}},{key:"onInteractStart",value:function(){this.stopAnimation(),this.isInteracting=!0}},{key:"onInteractStop",value:function(){this.isInteracting=!1,this.findSnapTarget()}},{key:"onInteract",value:function(){this.stopAnimation(),this.onScroll()}},{key:"onScroll",value:function(){clearTimeout(this.scrollTimeout),this.isInteracting||this.animation||(this.scrollTimeout=setTimeout(this.findSnapTarget.bind(this),50+this.options.delay))}},{key:"findSnapTarget",value:function(){var t=this.scrollContainer.scrollTop-this.currentScrollOffset.top,n=this.scrollContainer.scrollLeft-this.currentScrollOffset.left;this.currentScrollOffset={top:this.scrollContainer.scrollTop,left:this.scrollContainer.scrollLeft};var e,i,o,r=(e=this.container,i=this.panelList,o=l(e),i.filter((function(t){var n=t.getBoundingClientRect();return n.top<o.bottom&&n.right>o.left&&n.bottom>o.top&&n.left<o.right})));if(0===r.length)throw new Error("PanelSnap could not find a snappable panel, aborting.");if(r.length>1){if(Math.abs(t)<this.options.directionThreshold&&Math.abs(n)<this.options.directionThreshold&&this.activePanel)return void this.snapToPanel(this.activePanel,t>0,n>0);var s=t>0||n>0?1:r.length-2;this.snapToPanel(r[s],t<0,n<0)}else{var a=r[0];!function(t,n){var e=l(t),i=n.getBoundingClientRect();return i.top<=e.top&&i.bottom>=e.bottom||i.bottom<=e.bottom&&i.left<=e.left&&i.right>=e.right}(this.container,a)?console.warn("PanelSnap does not support space between panels."):this.activatePanel(a)}}},{key:"snapToPanel",value:function(n){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.activatePanel(n),this.isEnabled&&(this.animation&&this.animation.stop(),this.targetScrollOffset=c(this.container,n,i,o),this.animation=new t({start:0,end:1e4,duration:this.options.duration}),this.animation.on("tick",this.animationTick.bind(this)),this.animation.on("done",(function(){e.emit("snapStop",n),e.resetAnimation()})),this.emit("snapStart",n),this.animation.begin())}},{key:"animationTick",value:function(t){var n=this.targetScrollOffset.top-this.currentScrollOffset.top,e=this.currentScrollOffset.top+n*t/1e4;this.scrollContainer.scrollTop=e;var i=this.targetScrollOffset.left-this.currentScrollOffset.left,o=this.currentScrollOffset.left+i*t/1e4;this.scrollContainer.scrollLeft=o}},{key:"stopAnimation",value:function(){this.animation&&(this.animation.stop(),this.resetAnimation())}},{key:"resetAnimation",value:function(){this.currentScrollOffset={top:this.scrollContainer.scrollTop,left:this.scrollContainer.scrollLeft},this.targetScrollOffset={top:0,left:0},this.animation=null}},{key:"activatePanel",value:function(t){this.activePanel!==t&&(this.emit("activatePanel",t),this.activePanel=t)}}],s&&i(o.prototype,s),p&&i(o,p),n}();export default p;
